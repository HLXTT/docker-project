FROM nginx:latest

# Tạo thư mục chứa ảnh (nếu chưa tồn tại)
RUN mkdir -p /usr/share/nginx/html/images/

# Cấp quyền cho user PHP (www-data)
RUN chown -R www-data:www-data /usr/share/nginx/html/images && \
    chmod -R 775 /usr/share/nginx/html/images

# Copy ảnh vào container (nếu có sẵn)
COPY images/ /usr/share/nginx/html/images/

# Copy file cấu hình Nginx
COPY nginx.conf /etc/nginx/nginx.conf

# Script khởi động: Copy ảnh vào volume nếu chưa có dữ liệu
CMD ["/bin/sh", "-c", "cp -n /image-backup/* /usr/share/nginx/html/images/ && nginx -g 'daemon off;'"]
