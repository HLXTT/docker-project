# Dockerfile-nginx - Image Server
FROM nginx:latest

# Tạo thư mục chứa ảnh
RUN mkdir -p /usr/share/nginx/html/images/

# Cấp quyền cho user PHP (www-data)
RUN chown -R www-data:www-data /usr/share/nginx/html/images && \
    chmod -R 775 /usr/share/nginx/html/images

# Copy ảnh vào container
COPY images/ /usr/share/nginx/html/images/

# Copy file cấu hình Nginx
COPY nginx.conf /etc/nginx/nginx.conf

# Lắng nghe cổng do Railway cung cấp
ENV PORT=8080
RUN sed -i 's/listen 80;/listen ${PORT};/' /etc/nginx/nginx.conf

# Chạy Nginx ở foreground
CMD ["nginx", "-g", "daemon off;"]
